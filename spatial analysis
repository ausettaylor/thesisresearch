#single season occupancy analyses, need to separate by wet, dry, and late dry!!

#install necessary packages
install.packages('unmarked')

#load necessary packages
library(unmarked)
library(plyr)
library(dplyr)
library(lubridate)
#need this for join function??

#set working directory to the folder with the metadata csv file
setwd("~/Desktop/thesis")

#read in the data 
#do the spatial analysis BY SPECIES starting with baboons
#select data for only focal species
data <- read.csv("thesis_data.csv")

#create datasets for wet season analysis 
#before wild dog introduction
baboon_wet_before <- data[data$season_year == "Wet 2017"
                          & data$Species == "Baboon",]

#find the min/max date of the new dataframes!
#you have to do this for every data frame
min_date_bwb <- min(baboon_wet_before$DateTime)
max_date_bwb <- max(baboon_wet_before$DateTime)

#combine sightings by week
#step 1 convert date into an actual date, instead of character
baboon_wet_before$Date <- strptime(baboon_wet_before$Date, "%Y-%m-%d")
#step 2: organize dates into weeks
baboon_wet_before$week <- week(baboon_wet_before$Date)

names(baboon_wet_before)[1] <- "site"
baboon_wet_before <- baboon_wet_before[c("site", "week")]
baboon_wet_before <- baboon_wet_before[!duplicated(baboon_wet_before),]

#need to change week column to make wet season data continuous (add year to the end of season)
unique(baboon_wet_before$week)
baboon_wet_before$week <- 
  ifelse(baboon_wet_before$week <48,
         baboon_wet_before$week + 53,
         baboon_wet_before$week)
#make occupancy column
baboon_wet_before$occu <- 1
head(baboon_wet_before)

civet_wet_before <- data[data$season_year == "Wet 2017"
                          & data$Species == "Civet",]
genet_wet_before <- data[data$season_year == "Wet 2017"
                          & data$Species == "Genet",]
#after wild dog introduction
baboon_wet_after <- data[data$season_year == "Wet 2019"
                         & data$Species == "Baboon",]
civet_wet_after <- data[data$season_year == "Wet 2019"
                         & data$Species == "Civet",]
genet_wet_after <- data[data$season_year == "Wet 2019"
                         & data$Species == "Genet",]

#create datasets for early dry season analysis 
#before wild dog introduction
baboon_edry_before <- data[data$season_year == "Early Dry 2017"
                          & data$Species == "Baboon",]
civet_edry_before <- data[data$season_year == "Early Dry 2017"
                         & data$Species == "Civet",]
genet_edry_before <- data[data$season_year == "Early Dry 2017"
                         & data$Species == "Genet",]
#after wild dog introduction
baboon_edry_after <- data[data$season_year == "Early Dry 2019"
                         & data$Species == "Baboon",]
civet_edry_after <- data[data$season_year == "Early Dry 2019"
                        & data$Species == "Civet",]
genet_edry_after <- data[data$season_year == "Early Dry 2019"
                        & data$Species == "Genet",]

#create datasets for late dry season analysis 
#before wild dog introduction
baboon_ldry_before <- data[data$season_year == "Late Dry 2017"
                          & data$Species == "Baboon",]
civet_ldry_before <- data[data$season_year == "Late Dry 2017"
                         & data$Species == "Civet",]
genet_ldry_before <- data[data$season_year == "Late Dry 2017"
                         & data$Species == "Genet",]
#after wild dog introduction
baboon_ldry_after <- data[data$season_year == "Late Dry 2019"
                         & data$Species == "Baboon",]
civet_ldry_after <- data[data$season_year == "Late Dry 2019"
                        & data$Species == "Civet",]
genet_ldry_after <- data[data$season_year == "Late Dry 2019"
                        & data$Species == "Genet",]


#load in search effort 
searcheffort <- read.csv("SearchEffort.csv") 

#need to turn search effort date from "character" to a date
searcheffort$date <- strptime(searcheffort$date, "%m/%d/%y")
#now put it back into a character
searcheffort$date <- as.character(searcheffort$date)

#need to turn min/max dataframes to have their date information as a date not character
min_date_bwb <- strptime(min_date_bwb, "%Y-%m-%d")
max_date_bwb <- strptime(max_date_bwb, "%Y-%m-%d")
#make a vector that's a sequence of all the dates between min/max date
seqdates <- seq(min_date_bwb, max_date_bwb, by="days")
#turn this list into characters
seqdates <- as.character(seqdates)
#chop off the time part of the character string
seqdates <- substr(seqdates, 1, 10)

se_baboon_wet_before <- searcheffort[searcheffort$date %in%
                                       seqdates,]
#join search effort and data
baboon_wet_before <- join(se_baboon_wet_before, baboon_wet_before, type = "left"); head(baboon_wet_before)
#NAs when cams on but no sightings; change NAs to 0s for analysis
baboon_wet_before[is.na(baboon_wet_before)] <- 0
head(baboon_wet_before)
table(baboon_wet_before$occu)
head(se_baboon_wet_before)

#baboon wet season after wild dog introduction
min_date_bwa <- min(baboon_wet_after$DateTime)
max_date_bwa <- max(baboon_wet_after$DateTime)
#need to turn min/max dataframes to have their date information as a date not character
min_date_bwa <- strptime(min_date_bwa, "%Y-%m-%d")
max_date_bwa <- strptime(max_date_bwa, "%Y-%m-%d")

se_baboon_wet_after <- searcheffort[searcheffort$date %in%
                                      seq(min_date_bwa, max_date_bwa, by= "days"),]
#join search effort and data
baboon_wet_after <- join(se_baboon_wet_after, baboon_wet_after, type = "left"); head(baboon_wet_after)


#civet wet season analysis
#before wild dog introduction
min_date_cwb <- min(civet_wet_before$DateTime)
max_date_cwb <- max(civet_wet_before$DateTime)

#need to turn min/max dataframes to have their date information as a date not character
min_date_cwb <- strptime(min_date_cwb, "%Y-%m-%d")
max_date_cwb <- strptime(max_date_cwb, "%Y-%m-%d")

se_civet_wet_before <- searcheffort[searcheffort$date %in%
                                      seq(min_date_cwb, max_date_cwb, by= "days"),]
#join search effort and data
civet_wet_before <- join(se_civet_wet_before, civet_wet_before, type = "left"); head(civet_wet_before)

#after wild dog introduction
min_date_cwa <- min(civet_wet_after$DateTime)
max_date_cwa <- max(civet_wet_after$DateTime)

#need to turn min/max dataframes to have their date information as a date not character
min_date_cwa <- strptime(min_date_cwa, "%Y-%m-%d")
max_date_cwa <- strptime(max_date_cwa, "%Y-%m-%d")

se_civet_wet_after <- searcheffort[searcheffort$date %in%
                                     seq(min_date_cwa, max_date_cwa, by= "days"),]
#join search effort and data
civet_wet_after <- join(se_civet_wet_after, civet_wet_after, type = "left"); head(civet_wet_after)

#genet wet season analysis
#before wild dog introduction
min_date_gwb <- min(genet_wet_before$DateTime)
max_date_gwb <- max(genet_wet_before$DateTime)

#need to turn min/max dataframes to have their date information as a date not character
min_date_gwb <- strptime(min_date_gwb, "%Y-%m-%d")
max_date_gwb <- strptime(max_date_gwb, "%Y-%m-%d")

se_genet_wet_before <- searcheffort[searcheffort$date %in%
                                      seq(min_date_gwb, max_date_gwb, by= "days"),]
#join search effort and data
genet_wet_before <- join(se_genet_wet_before, genet_wet_before, type = "left"); head(genet_wet_before)

#after wild dog introduction
min_date_gwa <- min(genet_wet_after$DateTime)
max_date_gwa <- max(genet_wet_after$DateTime)

#need to turn min/max dataframes to have their date information as a date not character
min_date_gwa <- strptime(min_date_gwa, "%Y-%m-%d")
max_date_gwa <- strptime(max_date_gwa, "%Y-%m-%d")

se_genet_wet_after <- searcheffort[searcheffort$date %in%
                                     seq(min_date_gwa, max_date_gwa, by= "days"), ]
#join search effort and data
genet_wet_after <- join(se_genet_wet_after, genet_wet_after, type = "left"); head(genet_wet_after)


######################################
camtrap <- unmarkedFrameOccu(y=data, obsCovs=covs.obs)
summary(camtrap)
#########################################

